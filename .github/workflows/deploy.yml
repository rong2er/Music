name: Deploy to InfinityFree (FTPS)

on:
  push:
    branches: [ main ]   # 改成你的主分支

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Deploy with FTPS
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5   # 保持这个 Action
      with:
        server: ${{ secrets.FTP_SERVER }}           # ftpupload.net
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        protocol: ftps                              # 关键：强制 FTPS 加密
        port: 21                                    # InfinityFree FTPS 端口就是 21
        local-dir: ./
        server-dir: ${{ secrets.FTP_REMOTE_DIR }}/  # 必须以 / 结尾，如 /htdocs/
        dangerous-clean-slate: true                 # 删除远程多余文件（同步删除）
        exclude: |
          **/.git*
          **/.github/**
          README.md
          .gitignore
          LICENSE
        dry-run: false
        log-level: minimal
        timeout: 300
